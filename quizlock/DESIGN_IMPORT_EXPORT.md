# インポート/エクスポート機能 推奨設計

## 1. 現状の問題点

### 1.1 機能不足
- ❌ 問題の移動機能がない（グループ間で問題を移動できない）
- ❌ 問題のコピー機能がない（問題を複製して別のグループに追加できない）
- ❌ グループのコピー機能がない
- ❌ 一括操作がない（複数の問題を一度に移動/コピーできない）
- ❌ インポート時に既存のグループに追加する選択肢がない

### 1.2 UXの問題
- インポート時に常に新しいグループが作成される
- 問題を別のグループに移動するには削除→再作成が必要
- 複数の問題を一度に操作できない

## 2. 推奨設計

### 2.1 問題の移動機能
**目的**: グループ間で問題を移動できるようにする

**実装方法**:
- 問題のスワイプアクションまたはコンテキストメニューに「移動」を追加
- 移動先のグループを選択する画面を表示
- 元のグループから削除し、移動先のグループに追加

**UI**:
- 問題カードのスワイプアクションに「移動」ボタン
- グループ選択画面（モーダルまたはシート）

### 2.2 問題のコピー機能
**目的**: 問題を複製して別のグループに追加できるようにする

**実装方法**:
- 問題のスワイプアクションまたはコンテキストメニューに「コピー」を追加
- コピー先のグループを選択する画面を表示
- 新しいUUIDで問題を複製し、コピー先のグループに追加

**UI**:
- 問題カードのスワイプアクションに「コピー」ボタン
- グループ選択画面（複数選択可能）

### 2.3 グループのコピー機能
**目的**: グループ全体を複製できるようにする

**実装方法**:
- グループのスワイプアクションに「コピー」を追加
- グループ内の全問題をコピーし、新しいグループを作成
- グループ名に「コピー」を付加（例：「数学」→「数学 コピー」）

**UI**:
- グループのスワイプアクションに「コピー」ボタン

### 2.4 一括操作機能
**目的**: 複数の問題を一度に移動/コピーできるようにする

**実装方法**:
- グループ詳細画面に「選択モード」を追加
- 複数の問題を選択できるようにする
- 選択した問題を一括で移動/コピー/削除

**UI**:
- グループ詳細画面のツールバーに「選択」ボタン
- 選択モード時は各問題にチェックボックスを表示
- 選択した問題に対して一括操作メニューを表示

### 2.5 インポート機能の改善
**目的**: インポート時に柔軟な選択肢を提供する

**実装方法**:
- インポート時に以下の選択肢を提供：
  1. 新しいグループとして追加（既存の動作）
  2. 既存のグループに追加（グループを選択）
  3. 問題のみ追加（グループに所属させない）

**UI**:
- インポート画面で選択肢を表示
- 既存のグループを選択するピッカー

### 2.6 エクスポート機能の改善
**目的**: より柔軟なエクスポートを提供する

**実装方法**:
- 複数のグループを一度にエクスポート
- 選択した問題のみをエクスポート
- エクスポート形式の選択（単一ファイル or 複数ファイル）

**UI**:
- エクスポート時に選択画面を表示

## 3. 実装優先順位

### Phase 1（高優先度）
1. ✅ 問題の移動機能
2. ✅ 問題のコピー機能
3. ✅ インポート時のグループ選択

### Phase 2（中優先度）
4. ✅ グループのコピー機能
5. ✅ 一括操作機能

### Phase 3（低優先度）
6. ✅ 複数グループのエクスポート
7. ✅ 選択問題のエクスポート

## 4. データ構造の変更

### 4.1 新しいメソッド（AppModel）
```swift
// 問題の移動
func moveQuestion(questionId: UUID, fromGroupId: UUID, toGroupId: UUID)

// 問題のコピー
func copyQuestion(questionId: UUID, toGroupIds: [UUID]) -> Question

// グループのコピー
func copyGroup(groupId: UUID) -> QuestionGroup

// 複数問題の移動
func moveQuestions(questionIds: [UUID], fromGroupId: UUID, toGroupId: UUID)

// 複数問題のコピー
func copyQuestions(questionIds: [UUID], toGroupIds: [UUID]) -> [Question]
```

## 5. UI/UX設計

### 5.1 問題の移動/コピー
- スワイプアクションに「移動」「コピー」を追加
- タップでグループ選択画面を表示
- 複数グループを選択可能（コピーのみ）

### 5.2 グループ選択画面
- モーダルまたはシートで表示
- グループ一覧を表示
- チェックボックスで複数選択可能（コピーのみ）
- 「新規グループを作成」オプション

### 5.3 一括操作
- グループ詳細画面のツールバーに「選択」ボタン
- 選択モード時は各問題にチェックボックス
- 選択した問題数に応じて操作メニューを表示
